# AIK Minecraft Bot

ä¸€å€‹ä½¿ç”¨ mineflayer æ¡†æ¶é–‹ç™¼çš„ Minecraft æ©Ÿå™¨äººï¼Œæ”¯æ´ Microsoft å¸³è™Ÿèªè­‰ã€è‡ªå‹•ç‰ˆæœ¬åˆ¤æ–·åŠåŸºæœ¬èŠå¤©åŠŸèƒ½ã€‚

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

æœ¬å°ˆæ¡ˆæ—¨åœ¨å»ºç«‹ä¸€å€‹ç°¡å–®ä½†åŠŸèƒ½å®Œæ•´çš„ Minecraft botï¼Œå…·å‚™ä»¥ä¸‹ç‰¹è‰²ï¼š
- **Microsoft å¸³è™Ÿèªè­‰**: ä½¿ç”¨æ‚¨çš„ Microsoft å¸³è™Ÿå®‰å…¨ç™»å…¥
- **è‡ªå‹•ç‰ˆæœ¬åˆ¤æ–·**: è‡ªå‹•åµæ¸¬ä¸¦é©é…ä¼ºæœå™¨çš„ Minecraft ç‰ˆæœ¬
- **åŸºæœ¬èŠå¤©åŠŸèƒ½**: ç™»å…¥å¾Œæœƒåœ¨èŠå¤©é »é“ç™¼é€ "hello world" è¨Šæ¯
- **æ™ºèƒ½é‡é€£æ©Ÿåˆ¶**: ç•¶é€£ç·šä¸­æ–·æ™‚è‡ªå‹•å˜—è©¦é‡æ–°é€£æ¥
- **è©³ç´°æ—¥èªŒç³»çµ±**: æä¾›å®Œæ•´çš„é‹è¡Œç‹€æ…‹è¨˜éŒ„

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç³»çµ±éœ€æ±‚

- **Node.js**: ç‰ˆæœ¬ 21.0.0 æˆ–æ›´é«˜
- **npm**: éš¨ Node.js ä¸€èµ·å®‰è£
- **Minecraft å¸³è™Ÿ**: æ“æœ‰æ­£ç‰ˆ Microsoft å¸³è™Ÿçš„ Minecraft Java Edition

### å®‰è£æ­¥é©Ÿ

1. **å…‹éš†å°ˆæ¡ˆ**
   ```bash
   git clone <repository-url>
   cd AIK-bot
   ```

2. **è¨­å®š Node.js ç‰ˆæœ¬**
   ```bash
   nvm use
   ```
   
   > âš ï¸ **é‡è¦**: è«‹åœ¨æ¯æ¬¡é–‹ç™¼å‰éƒ½åŸ·è¡Œ `nvm use` ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„ Node.js ç‰ˆæœ¬ (22.17.1)

3. **å®‰è£ä¾è³´å¥—ä»¶**
   ```bash
   npm install
   ```

4. **é…ç½®ç’°å¢ƒè®Šæ•¸**
   ```bash
   # è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
   cp env.example .env
   
   # ç·¨è¼¯ .env æª”æ¡ˆï¼Œå¡«å…¥æ‚¨çš„è³‡è¨Š
   nano .env
   ```

5. **è¨­å®šæ‚¨çš„ Microsoft å¸³è™Ÿ**
   
   åœ¨ `.env` æª”æ¡ˆä¸­å¡«å…¥ä»¥ä¸‹è³‡è¨Šï¼š
   ```
   MINECRAFT_EMAIL=your-microsoft-email@example.com
   MINECRAFT_PASSWORD=your-password
   MINECRAFT_SERVER_HOST=localhost
   MINECRAFT_SERVER_PORT=25565
   BOT_USERNAME=MyBot
   ```

6. **å•Ÿå‹• Bot**
   ```bash
   npm start
   ```

### é–‹ç™¼æ¨¡å¼

å¦‚æœæ‚¨è¦é€²è¡Œé–‹ç™¼æˆ–æ¸¬è©¦ï¼Œè«‹å…ˆç¢ºèª Node.js ç‰ˆæœ¬ï¼Œç„¶å¾Œä½¿ç”¨é–‹ç™¼æ¨¡å¼ï¼š
```bash
# ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„ Node.js ç‰ˆæœ¬
nvm use

# å•Ÿå‹•é–‹ç™¼æ¨¡å¼
npm run dev
```

é–‹ç™¼æ¨¡å¼ä½¿ç”¨ nodemon ç›£è¦–æª”æ¡ˆè®Šæ›´ï¼Œç•¶ç¨‹å¼ç¢¼ä¿®æ”¹æ™‚æœƒè‡ªå‹•é‡å•Ÿ botã€‚å¦‚éœ€è©³ç´°è¼¸å‡ºï¼Œå¯ä½¿ç”¨ `npm run dev:verbose`ã€‚

> ğŸ’¡ **é–‹ç™¼æç¤º**: æ¯æ¬¡é–‹å•Ÿæ–°çš„çµ‚ç«¯è¦–çª—æ™‚ï¼Œè«‹è¨˜å¾—åŸ·è¡Œ `nvm use` ä»¥ç¢ºä¿ç‰ˆæœ¬ä¸€è‡´æ€§ã€‚

### å¯ç”¨çš„ npm è…³æœ¬

| æŒ‡ä»¤ | èªªæ˜ |
|------|------|
| `npm start` | å•Ÿå‹• bot (ç”Ÿç”¢æ¨¡å¼) |
| `npm run dev` | é–‹ç™¼æ¨¡å¼ (ä½¿ç”¨ nodemon è‡ªå‹•é‡å•Ÿ) |
| `npm run dev:verbose` | é–‹ç™¼æ¨¡å¼ (è©³ç´°è¼¸å‡º) |
| `npm run clean` | æ¸…é™¤ node_modules å’Œ package-lock.json |
| `npm run reinstall` | é‡æ–°å®‰è£æ‰€æœ‰ä¾è³´å¥—ä»¶ |

## ğŸ“ å°ˆæ¡ˆæ¶æ§‹

```
AIK-bot/
â”œâ”€â”€ .env                 # ç’°å¢ƒè®Šæ•¸ (ä¸æäº¤åˆ° git)
â”œâ”€â”€ .nvmrc              # Node.js ç‰ˆæœ¬æ§åˆ¶æª”æ¡ˆ
â”œâ”€â”€ env.example         # ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
â”œâ”€â”€ .gitignore          # Git å¿½ç•¥æª”æ¡ˆ
â”œâ”€â”€ package.json        # Node.js å°ˆæ¡ˆè¨­å®š
â”œâ”€â”€ index.js            # ä¸»ç¨‹å¼å…¥å£
â”œâ”€â”€ README.md           # æœ¬èªªæ˜æ–‡ä»¶
â”œâ”€â”€ spec.md             # å°ˆæ¡ˆè¦æ ¼æ–‡ä»¶
â”œâ”€â”€ CHANGELOG.md        # ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„
â””â”€â”€ .cursorrules        # é–‹ç™¼è¦ç¯„
```

## ğŸ”§ æ ¸å¿ƒæ¨¡çµ„èªªæ˜

### ä¸»ç¨‹å¼ (index.js)

ä¸»ç¨‹å¼åŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **é…ç½®ç®¡ç†**: å¾ç’°å¢ƒè®Šæ•¸è¼‰å…¥ bot é…ç½®
- **èªè­‰è™•ç†**: Microsoft å¸³è™Ÿç™»å…¥å’Œé©—è­‰
- **Bot ç”Ÿå‘½é€±æœŸ**: å»ºç«‹ã€é€£æ¥ã€é‡é€£é‚è¼¯
- **äº‹ä»¶è™•ç†**: èŠå¤©ã€éŒ¯èª¤ã€è¸¢å‡ºç­‰äº‹ä»¶
- **æ—¥èªŒç³»çµ±**: çµæ§‹åŒ–çš„æ—¥èªŒè¨˜éŒ„

### è³‡æ–™æµç¨‹

```mermaid
graph TD
    A[å•Ÿå‹•ç¨‹å¼] --> B[è¼‰å…¥ç’°å¢ƒè®Šæ•¸]
    B --> C[é©—è­‰é…ç½®]
    C --> D[å»ºç«‹ Bot å¯¦ä¾‹]
    D --> E[Microsoft èªè­‰]
    E --> F[é€£æ¥ä¼ºæœå™¨]
    F --> G[è‡ªå‹•åˆ¤æ–·ç‰ˆæœ¬]
    G --> H[æˆåŠŸç™»å…¥]
    H --> I[ç™¼é€ hello world]
    
    F --> J[é€£æ¥å¤±æ•—]
    J --> K[éŒ¯èª¤è™•ç†]
    K --> L[é‡æ–°é€£æ¥]
    L --> E
    
    H --> M[ç›£è½èŠå¤©]
    H --> N[è™•ç†äº‹ä»¶]
```

## âš™ï¸ é…ç½®é¸é …

### ç’°å¢ƒè®Šæ•¸èªªæ˜

| è®Šæ•¸åç¨± | å¿…å¡« | é è¨­å€¼ | èªªæ˜ |
|---------|------|--------|------|
| `MINECRAFT_EMAIL` | âœ… | - | Microsoft å¸³è™Ÿéƒµç®± |
| `MINECRAFT_PASSWORD` | âœ… | - | Microsoft å¸³è™Ÿå¯†ç¢¼ |
| `MINECRAFT_SERVER_HOST` | âŒ | localhost | ç›®æ¨™ä¼ºæœå™¨åœ°å€ |
| `MINECRAFT_SERVER_PORT` | âŒ | 25565 | ç›®æ¨™ä¼ºæœå™¨ç«¯å£ |
| `BOT_USERNAME` | âŒ | MyBot | Bot åœ¨éŠæˆ²ä¸­çš„æš±ç¨± |
| `LOG_LEVEL` | âŒ | info | æ—¥èªŒç­‰ç´š |

## ğŸ› ï¸ åŠŸèƒ½ç‰¹è‰²

### Microsoft èªè­‰
- ä½¿ç”¨å®˜æ–¹ Microsoft èªè­‰æµç¨‹
- å®‰å…¨çš„å¯†ç¢¼ç®¡ç†ï¼ˆä¸æœƒæ˜æ–‡å„²å­˜ï¼‰
- è‡ªå‹•è™•ç†èªè­‰å¤±æ•—æƒ…æ³

### ç‰ˆæœ¬è‡ªå‹•åˆ¤æ–·
- è‡ªå‹•åµæ¸¬ä¼ºæœå™¨çš„ Minecraft ç‰ˆæœ¬
- æ”¯æ´ä¸»æµç‰ˆæœ¬ï¼ˆ1.8 - 1.21ï¼‰
- ç„¡éœ€æ‰‹å‹•è¨­å®šç‰ˆæœ¬è™Ÿ

### æ™ºèƒ½é‡é€£
- ç¶²è·¯ä¸­æ–·è‡ªå‹•é‡é€£
- ä¼ºæœå™¨è¸¢å‡ºå¾Œé‡é€£
- æ¼¸é€²å¼é‡é€£å»¶é²

### æ—¥èªŒç³»çµ±
- æ™‚é–“æˆ³è¨˜æ ¼å¼åŒ–
- åˆ†ç´šæ—¥èªŒè¨˜éŒ„
- çµæ§‹åŒ–éŒ¯èª¤ä¿¡æ¯

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**Q: Bot ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ï¼Ÿ**
A: è«‹æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š
- ä¼ºæœå™¨åœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¢º
- ä¼ºæœå™¨æ˜¯å¦æ­£åœ¨é‹è¡Œ
- ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸
- é˜²ç«ç‰†è¨­å®šæ˜¯å¦é˜»æ“‹é€£æ¥

**Q: Microsoft èªè­‰å¤±æ•—ï¼Ÿ**
A: å¯èƒ½çš„åŸå› ï¼š
- å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤
- å¸³è™Ÿå•Ÿç”¨äº†å…©æ­¥é©Ÿé©—è­‰
- å¸³è™Ÿæœªè³¼è²· Minecraft Java Edition
- ç¶²è·¯é€£æ¥å•é¡Œ

**Q: Bot ç™»å…¥å¾Œç«‹å³è¢«è¸¢å‡ºï¼Ÿ**
A: å¯èƒ½çš„åŸå› ï¼š
- ä¼ºæœå™¨ä¸å…è¨±ç›¸åŒç”¨æˆ¶å
- ä¼ºæœå™¨æœ‰ç™½åå–®é™åˆ¶
- ä¼ºæœå™¨ç‰ˆæœ¬ä¸ç›¸å®¹

### æ—¥èªŒåˆ†æ

æŸ¥çœ‹ç¨‹å¼è¼¸å‡ºçš„æ—¥èªŒä¿¡æ¯ï¼Œé€šå¸¸æœƒåŒ…å«éŒ¯èª¤çš„è©³ç´°æè¿°ã€‚å¸¸è¦‹çš„æ—¥èªŒæ ¼å¼ï¼š
```
[2024-01-XX] [INFO] Bot å·²æˆåŠŸç™»å…¥ä¸¦ç”Ÿæˆåœ¨ä¸–ç•Œä¸­ï¼
[2024-01-XX] [ERROR] Bot ç™¼ç”ŸéŒ¯èª¤: Invalid credentials
```

## ğŸ”’ å®‰å…¨æ€§æ³¨æ„äº‹é …

1. **æ°¸é ä¸è¦å°‡ `.env` æª”æ¡ˆæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±**
2. **å®šæœŸæ›´æ›å¯†ç¢¼**
3. **ä¸è¦åœ¨å…¬å…±å ´æ‰€å±•ç¤ºå«æœ‰å¸³è™Ÿä¿¡æ¯çš„ç•«é¢**
4. **è€ƒæ…®ä½¿ç”¨å°ˆç”¨çš„ bot å¸³è™Ÿ**

## ğŸ“ é–‹ç™¼æŒ‡å—

### ä»£ç¢¼é¢¨æ ¼
- ä½¿ç”¨ ES6+ èªæ³•
- å„ªå…ˆä½¿ç”¨ ES Modules (import/export)
- ä½¿ç”¨ async/await è™•ç†ç•°æ­¥æ“ä½œ
- é©ç•¶çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„

### æ“´å±•åŠŸèƒ½
å¦‚æœæ‚¨æƒ³è¦æ“´å±• bot çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ä¸»ç¨‹å¼ä¸­æ·»åŠ æ›´å¤šäº‹ä»¶ç›£è½å™¨ï¼š

```javascript
// ç›£è½ç©å®¶åŠ å…¥
bot.on('playerJoined', (player) => {
    bot.chat(`æ­¡è¿ ${player.username} åŠ å…¥ä¼ºæœå™¨ï¼`);
});

// ç›£è½ç§äººè¨Šæ¯
bot.on('whisper', (username, message) => {
    console.log(`${username} ç§è¨Š: ${message}`);
});
```

## ğŸ¤ è²¢ç»æŒ‡å—

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼è«‹éµå¾ªä»¥ä¸‹è¦ç¯„ï¼š

1. æäº¤å‰è«‹å…ˆæ¸¬è©¦æ‚¨çš„æ›´æ”¹
2. éµå¾ªç¾æœ‰çš„ä»£ç¢¼é¢¨æ ¼
3. æ›´æ–°ç›¸é—œæ–‡æª”
4. ä½¿ç”¨æœ‰æ„ç¾©çš„ commit è¨Šæ¯

## ğŸ“„ æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šæ¢æ¬¾ã€‚è©³ç´°ä¿¡æ¯è«‹åƒé–± LICENSE æª”æ¡ˆã€‚

## ğŸ”— ç›¸é—œè³‡æº

- [Mineflayer å®˜æ–¹æ–‡æª”](https://github.com/PrismarineJS/mineflayer)
- [Node.js å®˜æ–¹ç¶²ç«™](https://nodejs.org/)
- [Minecraft å®˜æ–¹ç¶²ç«™](https://www.minecraft.net/)

---

**æ³¨æ„**: æœ¬å°ˆæ¡ˆåƒ…ä¾›å­¸ç¿’å’Œç ”ç©¶ç”¨é€”ã€‚è«‹éµå®ˆ Minecraft æœå‹™æ¢æ¬¾å’Œç›¸é—œä¼ºæœå™¨è¦å‰‡ã€‚ 

## ğŸ› ï¸ æ•…éšœæ’é™¤ (Troubleshooting)

### å·²çŸ¥å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

#### Mineflayer èŠå¤©åŠŸèƒ½å´©æ½°å•é¡Œ

**å•é¡Œæè¿°**: 
Bot åœ¨è™•ç†èŠå¤©è¨Šæ¯æ™‚å´©æ½°ï¼ŒéŒ¯èª¤è¨Šæ¯ï¼š
```
TypeError [ERR_INVALID_ARG_TYPE]: The "list" argument must be an instance of Array. Received an instance of Buffer
    at Function.concat (node:buffer:579:3)
    at updateAndValidateSession (node_modules\minecraft-protocol\src\client\chat.js:61:114)
```

**å½±éŸ¿ç‰ˆæœ¬**: 
- mineflayer: 4.30.0
- minecraft-protocol: ç›¸é—œç‰ˆæœ¬
- Node.js: 22.17.1

**åŸå› **: 
minecraft-protocol åº«åœ¨è™•ç†èŠå¤©è¨Šæ¯ç°½åé©—è­‰æ™‚ï¼Œé æœŸæ”¶åˆ° Array ä½†å¯¦éš›æ”¶åˆ°äº† Bufferã€‚

**è§£æ±ºæ–¹æ¡ˆ**: 

**æ–¹æ¡ˆ 1: æš«æ™‚åœç”¨èŠå¤©ç›£è½å™¨ (ç›®å‰æ¡ç”¨)**
```javascript
// æš«æ™‚è¨»è§£æ‰èŠå¤©ç›£è½å™¨ï¼Œé¿å…å´©æ½°
// bot.on('chat', (username, message) => {
//     // èŠå¤©ç›¸é—œè™•ç†
// });
```

**æ–¹æ¡ˆ 2: ä¿®è£œ minecraft-protocol åº«**
ä¿®æ”¹ `node_modules/minecraft-protocol/src/client/chat.js` ç¬¬ 61 è¡Œï¼š
```javascript
// åŸå§‹ç¨‹å¼ç¢¼ (æœ‰å•é¡Œ)
const acknowledgements = previousMessages.length > 0 ? ['i32', previousMessages.length, 'buffer', Buffer.concat(previousMessages.map(msg => msg.signature || client._signatureCache[msg.id]))] : ['i32', 0]

// ä¿®æ­£ç¨‹å¼ç¢¼ (è‡¨æ™‚ä¿®å¾©)
const acknowledgements = previousMessages.length > 0 ? ['i32', previousMessages.length, 'buffer', Buffer.concat(previousMessages.map(msg => msg.signature || client._signatureCache[msg.id]).filter(buf => Buffer.isBuffer(buf)))] : ['i32', 0]
```

**ç›¸é—œè³‡æº**: 
- GitHub Issue: [Bot crashes after multiple chats #3703](https://github.com/PrismarineJS/mineflayer/issues/3703)
- æ­¤å•é¡Œå¹«åŠ©è§£æ±ºäº†æœ¬å°ˆæ¡ˆçš„ç›¸åŒå´©æ½°å•é¡Œ

**æ³¨æ„äº‹é …**:
- æ–¹æ¡ˆ 2 éœ€è¦åœ¨æ¯æ¬¡ `npm install` å¾Œé‡æ–°æ‡‰ç”¨
- å»ºè­°é—œæ³¨å®˜æ–¹ issue æ›´æ–°ï¼Œç­‰å¾…æ­£å¼ä¿®å¾©
- ç›®å‰å°ˆæ¡ˆæ¡ç”¨æ–¹æ¡ˆ 1 ç¢ºä¿ç©©å®šæ€§

---

## ğŸ“ æ”¯æ´

å¦‚æœé‡åˆ°å…¶ä»–å•é¡Œï¼Œè«‹åƒè€ƒï¼š
1. æª¢æŸ¥å°ˆé–€çš„ **[æ•…éšœæ’é™¤æŒ‡å—](./TROUBLESHOOTING.md)** ğŸ“‹
2. æŸ¥çœ‹ [mineflayer å®˜æ–¹æ–‡æª”](https://github.com/PrismarineJS/mineflayer)
3. æœå°‹ [GitHub Issues](https://github.com/PrismarineJS/mineflayer/issues)
4. æŸ¥çœ‹æœ¬å°ˆæ¡ˆçš„ `spec.md` äº†è§£è©³ç´°è¦æ ¼

--- 